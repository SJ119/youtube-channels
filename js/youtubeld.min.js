function httpGet(e){var t=new XMLHttpRequest;return t.open("GET",e,!1),t.send(null),t.responseText}function requestData(e,t){var n="AIzaSyAfipZJqJ4ndJZHf_HFjm2E__1kaOMeqBY",i="https://www.googleapis.com/youtube/v3/search?part=id%2Csnippet&maxResults=1&q="+e+"&type=channel&key="+n,s=JSON.parse(httpGet(i)),a=s.items[0].id.channelId,l="https://www.googleapis.com/youtube/v3/channels?part=brandingSettings,contentDetails&id="+a+"&key="+n,r=JSON.parse(httpGet(l)),d=r.items[0].contentDetails.relatedPlaylists.uploads,c="https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults="+t+"&playlistId="+d+"&key="+n,o=JSON.parse(httpGet(c)),u=["snippet","statistics"],p=o.items.map(function(e){return e.snippet.resourceId.videoId}),g="https://www.googleapis.com/youtube/v3/videos?part="+u+"&id="+p+"&key="+n,v=JSON.parse(httpGet(g));return{ratings:v.items,branding:r.items[0]}}function changeChannel(){var e=$("#channel")[0].value.replace(" ","");if(null!=e){channel=e;var t=requestData(channel,amount);init(t)}}function changeOptions(){var e=$("#amount")[0].value;null!=e&&(amount=e);var t=$("#sort")[0].value;if(null!=t&&(sort=t),null!=e||null!=t){var n=requestData(channel,amount);init(n)}}function init(e){d3.select(".channel-container").selectAll("*").remove(),d3.select(".video-container").selectAll("*").remove(),d3.select(".banner-container").selectAll("*").remove();var t=(d3.select(".banner-container").append("img").attr({"class":"banner-image",src:e.branding.brandingSettings.image.bannerImageUrl,width:"100%"}),parseInt(d3.select(".banner-container")[0][0].getBoundingClientRect().width));d3.select(".content-container").style({"margin-left":"auto","margin-right":"auto",width:t+"px"});var n=parseInt($(".channel-container").innerWidth())-4*parseInt($(".channel-container").css("padding-left")),i=parseInt(9*n/16);$(".channel-container").append('<iframe class="selected-video" src="http://www.youtube.com/embed/'+e.ratings[0].id+'"></iframe>'),$(".selected-video").attr({width:n,height:i}),$(".channel-container").append('<div class="video-information"></div>'),$(".video-information").append('<span class="video-likes"></span><span class="video-dislikes"></span><span class="video-views"></span>'),d3.select(".video-likes").text("Likes: "+e.ratings[0].statistics.likeCount),d3.select(".video-dislikes").text("Dislikes: "+e.ratings[0].statistics.dislikeCount),d3.select(".video-views").text("Views: "+e.ratings[0].statistics.viewCount);var s=parseInt(.8*d3.select(".video-container")[0][0].getBoundingClientRect().width),a=d3.scale.linear().domain([0,100]).range([0,s]),l=d3.select(".video-container").append("div").attr({"class":"info-container"}),r=l.append("div").attr({"class":"results-info"}).append("div").attr({"class":"results"});r.selectAll(".bar-widgets").data(e.ratings).enter().append("div").on("mouseout",function(e,t){d3.select(".widget-container-"+t).classed("selected")||d3.select(".widget-container-"+t).classed({mouseover:!1,selected:!1})}).on("mouseover",function(e,t){d3.select(".widget-container-"+t).classed("selected")||d3.select(".widget-container-"+t).classed({mouseover:!0,selected:!1})}).on("click",function(e,t){d3.selectAll(".widget-container").classed({mouseover:!1,selected:!1}),d3.select(".widget-container-"+t).classed({mouseover:!1,selected:!0}),$(".selected-video").attr("src","http://www.youtube.com/embed/"+e.id),d3.select(".video-likes").text("Likes: "+e.statistics.likeCount),d3.select(".video-dislikes").text("Dislikes: "+e.statistics.dislikeCount),d3.select(".video-views").text("Views: "+e.statistics.viewCount)}).attr({"class":function(e,t){return"widget-container widget-container-"+t}}).style({opacity:0}),r.selectAll(".widget-container").transition().duration(function(e,t){return 100*t+2e3}).style({opacity:1}),r.selectAll(".widget-number").style({left:function(e){return"-"+(this.getBoundingClientRect().width+5)+"px"}}),r.selectAll(".widget-container").append("div").attr({"class":"bar-widget"}),r.selectAll(".bar-widget").append("svg").attr({"class":"bar-widget-svg",height:20,width:s}).append("line").attr({"class":"bar-widget-background-line",x1:0,x2:s,y1:15,y2:15,stroke:"#E7E7E7","stroke-width":1}),r.selectAll(".bar-widget").select(".bar-widget-svg").append("line").attr({"class":"bar-widget-results",x1:0,x2:0,y1:15,y2:15,stroke:"#55F400","stroke-width":8}).transition().duration(function(e,t){return 100*t+2e3}).attrTween("x2",function(e,t){var n=parseInt(e.statistics.likeCount),i=parseInt(e.statistics.dislikeCount);e.ratingPct=parseInt(n/(n+i)*100);var s=d3.interpolate(0,e.ratingPct),l=t;return function(e){for(var t=d3.select(".threshold-lines-"+l).selectAll(".line")[0],n=0;3>n&&t[n].__data__<s(e);n++)d3.select(t[n]).attr({stroke:"grey"});return a(s(e))}}),r.selectAll(".bar-widget-svg").append("g").attr({"class":function(e,t){return"bar-widget-threshold-lines threshold-lines-"+t}}).selectAll(".line").data(thresholds).enter().append("line").attr({"class":function(e,t){return"line line-"+t},x1:function(e){return a(e)},x2:function(e){return a(e)},y1:11,y2:19,stroke:"#FFFFFF","stroke-width":1}),r.selectAll(".bar-widget").append("div").attr({"class":"info"}).style({width:s+"px",height:"20px"}).append("span").attr({"class":"video-title"}).text(function(e,t){return t+". "+e.snippet.title}).style({"max-width":.85*s+"px",overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap"}),r.selectAll(".info").append("span").attr({"class":"video-rating"}).text(function(e){return"0%"}).transition().duration(function(e,t){return 100*t+2e3}).tween("text",function(e){var t=d3.interpolate(0,e.ratingPct);return function(e){this.textContent=Math.round(t(e))+"%"}})}var channel="JimmyKimmelLive",amount=10,sort="date",thresholds=[25,50,75],update=function(e){var t=parseInt(d3.select(".banner-container")[0][0].getBoundingClientRect().width);d3.select(".content-container").style({"margin-left":"auto","margin-right":"auto",width:t+"px"});var n=parseInt($(".channel-container").innerWidth())-4*parseInt($(".channel-container").css("padding-left")),i=parseInt(9*n/16);$(".selected-video").attr({width:n,height:i});var s=parseInt(.8*d3.select(".video-container")[0][0].getBoundingClientRect().width),a=d3.scale.linear().domain([0,100]).range([0,s]);d3.selectAll(".bar-widget-svg").attr({width:s}),d3.selectAll(".bar-widget-background-line").attr({x2:s}),d3.selectAll(".info").style({width:s+"px"}),d3.selectAll(".video-title").style({"max-width":.85*s+"px"}),d3.selectAll(".bar-widget").select(".bar-widget-svg").select(".bar-widget-results").attr({x2:function(e){return a(e.ratingPct)}}),d3.selectAll(".bar-widget-svg").selectAll(".line").attr({x1:function(e){return a(e)},x2:function(e){return a(e)}})};$(document).ready(function(){var e=requestData(channel,amount);init(e),$(window).resize(function(){update(e)})});